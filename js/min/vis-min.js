var w=window,d=document,e=d.documentElement,g=d.getElementsByTagName("body")[0],x=w.innerWidth||e.clientWidth||g.clientWidth,y=w.innerHeight||e.clientHeight||g.clientHeight,scale0=(x-1)/2/Math.PI,svg=d3.select("body").style("margin","0").append("svg").attr({width:x,height:y}).style("background","#b1d8b7");d3.select(window).on("resize",function(){x=w.innerWidth||e.clientWidth||g.clientWidth,y=w.innerHeight||e.clientHeight||g.clientHeight,svg.attr({width:x,height:y})});var projection=d3.geo.mercator().translate([x/2,y/2]).scale(11e3).center([5.478594,52.04337]),path=d3.geo.path().projection(projection),tooltip=d3.select("body").append("div").attr("class","hidden tooltip");d3.json("d/NL.json",function(e,t){if(e)return console.error(e);var n=topojson.feature(t,t.objects._nl),r=topojson.feature(t,t.objects._places);svg.selectAll(".netherland").data(n.features).enter().append("path").attr({"class":function(e){return"netherland "+e.properties.name},d:path,fill:"#608157"}),svg.selectAll(".city").data(r.features).enter().append("circle").attr({"class":function(e){return"city "+e.properties.name},r:"2px",fill:"#cfcfcf",transform:function(e){return"translate("+path.centroid(e)+")"}}),svg.selectAll(".city-label").data(r.features).enter().append("text").text(function(e){return e.properties.name}).attr({"class":function(e){return"city-label "+e.properties.name},transform:function(e){return"translate("+projection(e.geometry.coordinates)+")"},dy:"1.1em"});var o=!1;d3.csv("d/phonesCity.csv",function(e,t){return e?console.error(e):(console.log(t),svg.selectAll(".stop").data(t).enter().append("circle").attr({"class":function(e){return"stop "+e.Places},r:function(e){return"Eindhoven"==e.Places?"6px":"5px"},fill:function(e){return"Eindhoven"==e.Places?"#2ed0de":"#FFF"},transform:function(e){return"translate("+projection([e.lng,e.lat])+")"}}).on("click",function(e){if("Eindhoven"==e.Places){var t=0;o=o?!1:!0,t=o?"20%":"0%",d3.select("#sideBar").style("width",t)}}).transition().duration(1200),svg.selectAll(".stop-label").data(t).enter().append("text").text(function(e){return e.Places}).attr({"class":function(e){return"stop-label "+e.Places},transform:function(e){return"translate("+projection([e.lng,e.lat])+")"},dy:"1.4em"}).attr("dx",function(e){return"Oost-Nieuw-west"==e.Places?"-1em":"0"}),void svg.selectAll(".performanceBar").data(t).enter().append("rect").attr({"class":"performanceBar",width:"20px",y:function(e){return-10-e.Phones/10},height:function(e){return e.Phones/10},x:"-11px",fill:"white",opacity:".7",transform:function(e){return"translate("+projection([e.lng,e.lat])+")"}}).on("mousemove",function(e){var t=d3.mouse(svg.node()).map(function(e){return parseInt(e)});tooltip.classed("hidden",!1).attr("style","left:"+(t[0]+15)+"px; top:"+(t[1]-35)+"px").html("<h4>@"+e.Places+'</h4> <br> This city has <span style="font-weight: bold">  '+e.Phones+"</span> phones recycled."+e.CO2ByGram+" grams of carbon emmission is reduced by people in the city.")}).on("mouseout",function(){tooltip.classed("hidden",!0)}))})});